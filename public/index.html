<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css"
			integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk="
			crossorigin="anonymous"
		/>
		<link rel="stylesheet" href="css/style.css" />
		<title>ChatCord App</title>
		<style>
			.auth-section {
				margin: 20px 0;
				padding: 20px;
				background: rgba(255, 255, 255, 0.05);
				border-radius: 10px;
				border: 1px solid rgba(255, 255, 255, 0.1);
			}
			.user-badge {
				display: flex;
				align-items: center;
				gap: 12px;
				margin-bottom: 15px;
			}
			.user-badge img {
				width: 50px;
				height: 50px;
				border-radius: 50%;
				border: 2px solid var(--primary-color);
			}
			.user-info h3 {
				margin: 0;
				color: var(--primary-color);
			}
			.user-info p {
				margin: 5px 0 0 0;
				font-size: 0.9em;
				opacity: 0.8;
			}
			.auth-buttons {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
			}
			.btn-secondary {
				background: #6c757d;
			}
			.btn-secondary:hover {
				background: #5a6268;
			}
		</style>
	</head>
	<body>
			</style>
</head>
<body>
	<!-- Loading Screen -->
	<div class="loading-screen">
		<div class="loading-logo">
			<div class="logo-circles">
				<div class="logo-circle"></div>
				<div class="logo-circle"></div>
				<div class="logo-circle"></div>
			</div>
			<i class="fas fa-smile logo-icon"></i>
		</div>
		<div class="loading-text">Welcome to ChatCord...</div>
		<div class="loading-bar-container">
			<div class="loading-bar"></div>
		</div>
	</div>

	<!-- Cosmic space background layers -->
		<div class="space-layer"></div>
		<div class="stars-distant"></div>
		<div class="stars-mid"></div>
		<div class="stars-close"></div>
		<div class="clouds"></div>
		<div class="shooting-star"></div>
		<div class="shooting-star"></div>
		<div class="shooting-star"></div>
		<div class="comet"></div>
		<div class="comet"></div>
		
		<div class="join-container">
			<header class="join-header">
				<h1><i class="fas fa-smile"></i> ChatCord</h1>
			</header>
			<main class="join-main">
				<!-- Auth0 Section -->
				<div class="auth-section" id="auth-section">
					<div id="auth-loading">
						<p>Loading authentication...</p>
					</div>
					<div id="auth-logged-out" style="display: none;">
						<h3>üîê Secure Login</h3>
						<p>Login with your account for a personalized experience</p>
						<div class="auth-buttons">
							<a href="/login" class="btn">
								<i class="fas fa-sign-in-alt"></i> Login with Auth0
							</a>
							<button onclick="skipAuth()" class="btn btn-secondary">
								Continue as Guest
							</button>
						</div>
					</div>
					<div id="auth-logged-in" style="display: none;">
						<div class="user-badge">
							<img id="user-picture" src="" alt="User">
							<div class="user-info">
								<h3 id="user-name"></h3>
								<p id="user-email"></p>
							</div>
						</div>
						<div class="auth-buttons">
							<a href="/profile" class="btn btn-secondary">
								<i class="fas fa-user"></i> Profile
							</a>
							<a href="/logout" class="btn" style="background: #dc3545;">
								<i class="fas fa-sign-out-alt"></i> Logout
							</a>
						</div>
					</div>
					<div id="auth-disabled" style="display: none;">
						<p><i class="fas fa-info-circle"></i> Authentication is not configured</p>
					</div>
				</div>

			<!-- Chat Form -->
			<form id="chat-form">
				<div class="form-control">
					<label for="username">Username</label>
					<input type="text" name="username" id="username" placeholder="Enter username..." required />
				</div>
				<button type="submit" class="btn">
					<i class="fas fa-door-open"></i> Select Chat Room
				</button>
			</form>				<script>
				// Check authentication status
				async function checkAuth() {
					try {
						const response = await fetch('/api/user');
						const data = await response.json();
						
						document.getElementById('auth-loading').style.display = 'none';
						
						if (data.isAuthenticated) {
							// User is logged in - redirect to dashboard
							const username = data.user.name || data.user.email;
							const avatar = data.user.picture;
							
							// Store user info
							try {
								localStorage.setItem('username', username);
								localStorage.setItem('userAvatar', avatar);
								localStorage.setItem('userEmail', data.user.email);
							} catch (e) {}
							
							// Redirect to dashboard
							window.location.href = `dashboard.html?username=${encodeURIComponent(username)}`;
							return;
						} else {
							// User is not logged in
							document.getElementById('auth-logged-out').style.display = 'block';
						}
					} catch (error) {
						// Auth0 not configured or error
						document.getElementById('auth-loading').style.display = 'none';
						document.getElementById('auth-disabled').style.display = 'block';
						
						// Prefill username from localStorage (if present)
						try {
							const saved = localStorage.getItem('chatcordUser');
							if (saved) {
								document.getElementById('username').value = saved;
							}
						} catch (e) {}
					}
				}

			function skipAuth() {
				document.getElementById('auth-section').style.display = 'none';
			}

			// Hide loading screen after page loads
			window.addEventListener('load', () => {
				setTimeout(() => {
					document.querySelector('.loading-screen').classList.add('hidden');
				}, 1500);
			});

			// Handle form submission - redirect to rooms page
			document.getElementById('chat-form').addEventListener('submit', function(e) {
				e.preventDefault();
				const username = document.getElementById('username').value.trim();
				if (username) {
					// Show loading screen
					const loadingScreen = document.querySelector('.loading-screen');
					loadingScreen.classList.remove('hidden');
					document.querySelector('.loading-text').textContent = 'Loading Rooms...';
					
					// Save username to localStorage
					try {
						localStorage.setItem('chatcordUser', username);
					} catch (e) {}
					
					// Redirect to rooms page with username after animation
					setTimeout(() => {
						window.location.href = `rooms.html?username=${encodeURIComponent(username)}`;
					}, 1200);
					}
				});

				// Load authentication status
				checkAuth();
				</script>
			</main>
		</div>

		<!-- Theme toggle (fixed top-right) -->
		<button id="theme-toggle" class="btn theme-toggle" aria-label="Toggle theme">üåó</button>

		<!-- Inline theme toggle logic for index (keeps index lightweight and avoids loading chat JS) -->
		<script>
		(function(){
			const THEME_KEY = 'chatcordTheme';
			const toggle = document.getElementById('theme-toggle');
			function applyTheme(theme){
				if(theme==='dark') document.body.classList.add('dark'); else document.body.classList.remove('dark');
				try{ localStorage.setItem(THEME_KEY, theme); }catch(e){}
			}
			const saved = (function(){ try{ return localStorage.getItem(THEME_KEY);}catch(e){return null;} })();
			const defaultTheme = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
			applyTheme(defaultTheme);
			if(!toggle) return;
			toggle.innerText = document.body.classList.contains('dark') ? 'üåô' : 'üåó';
			toggle.addEventListener('click', ()=>{
				const isDark = document.body.classList.toggle('dark');
				applyTheme(isDark ? 'dark' : 'light');
				toggle.innerText = isDark ? 'üåô' : 'üåó';
			});
		})();
		</script>
	</body>
</html>
